---
phase: 02-install-and-deploy-skills
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .agents/skills/nsyte-deploy/SKILL.md
  - .agents/skills/nsyte-concepts/SKILL.md
  - .agents/skills/nsyte-concepts/references/nostr-concepts.md
autonomous: true
requirements:
  - DEPL-01
  - DEPL-02
  - DEPL-03

must_haves:
  truths:
    - "nsyte-deploy SKILL.md body contains the full deploy workflow: nsyte deploy <dir>"
    - "nsyte-deploy SKILL.md body contains the auth decision tree with --sec flag and stored bunker"
    - "nsyte-deploy SKILL.md body contains deploy output interpretation for success, partial, and failure"
    - "nsyte-deploy SKILL.md body contains error recovery guidance for relay, auth, and Blossom failures"
    - "nsyte-deploy SKILL.md body references nsyte-concepts skill for Nostr domain vocabulary"
    - "nostr-concepts.md no longer references non-existent nsyte login command"
  artifacts:
    - path: ".agents/skills/nsyte-deploy/SKILL.md"
      provides: "Deploy workflow, auth tree, output interpretation, error recovery"
      contains: "nsyte deploy"
    - path: ".agents/skills/nsyte-concepts/SKILL.md"
      provides: "Minimal body pointing to references/nostr-concepts.md"
      contains: "nostr-concepts.md"
    - path: ".agents/skills/nsyte-concepts/references/nostr-concepts.md"
      provides: "Corrected Nostr domain vocabulary (nsyte init, not nsyte login)"
      contains: "nsyte init"
  key_links:
    - from: ".agents/skills/nsyte-deploy/SKILL.md"
      to: ".agents/skills/nsyte-concepts/references/nostr-concepts.md"
      via: "skill body references concepts file for Nostr vocabulary"
      pattern: "nsyte-concepts"
    - from: ".agents/skills/nsyte-deploy/SKILL.md"
      to: ".agents/skills/nsyte-setup/SKILL.md"
      via: "deploy skill notes setup as prerequisite"
      pattern: "nsyte-setup"
---

<objective>
Write the nsyte-deploy skill body covering the full deploy workflow, auth decision tree, output interpretation, and error recovery. Also fix the nostr-concepts.md reference to use nsyte init (not nsyte login) and add minimal body to nsyte-concepts SKILL.md.

Purpose: The deploy skill is the primary value-delivery workflow — deploying a static site to Nostr/Blossom. This is the skill agents will use most frequently. The concepts corrections ensure agents are not directed to non-existent commands.

Output: Complete nsyte-deploy/SKILL.md body, updated nostr-concepts.md, minimal nsyte-concepts/SKILL.md body
</objective>

<execution_context>
@/home/sandwich/.claude/get-shit-done/workflows/execute-plan.md
@/home/sandwich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-install-and-deploy-skills/02-RESEARCH.md
@.agents/skills/nsyte-deploy/SKILL.md
@.agents/skills/nsyte-concepts/SKILL.md
@.agents/skills/nsyte-concepts/references/nostr-concepts.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write nsyte-deploy SKILL.md body</name>
  <files>.agents/skills/nsyte-deploy/SKILL.md</files>
  <action>
Replace the stub comment in nsyte-deploy/SKILL.md with a complete skill body. Keep the existing frontmatter (name, description, metadata.disable-model-invocation: true) unchanged. The body must be procedural and decision-tree-driven, targeting 150-200 lines max.

Structure the body with these sections:

**## Prerequisites**
- nsyte must be installed (see `nsyte-setup` skill)
- `.nsite/config.json` must exist (from `nsyte init`) OR deploy interactively (it will auto-run setup)
- For Nostr/Blossom domain concepts, see the `nsyte-concepts` skill or `references/nostr-concepts.md`

**## Authentication**
Document the auth decision tree from research (Pattern 2):

Priority 1: `--sec` flag (CLI-provided or from environment variable)
- Accepts: nsec1... (bech32 private key), nbunksec1... (bunker credential for CI/CD), bunker://... (bunker URL), 64-char hex (raw private key)
- Format auto-detected by nsyte, no format flag needed
- CI/CD pattern: `nsyte deploy ./dist --sec "${NBUNK_SECRET}"` where NBUNK_SECRET is an env var

Priority 2: Stored bunker from .nsite/config.json
- config.bunkerPubkey set AND nbunksec stored in OS keychain
- If stored credential missing: interactive mode prompts to reconnect; non-interactive mode errors

If neither available: nsyte errors with actionable message

CRITICAL: Do NOT document a standalone env var auth path. nsyte does not read NSYTE_NSEC or similar env vars. The CI pattern passes env var values via the `--sec` flag.
CRITICAL: Do NOT document `--nbunksec` as a flag. The unified flag is `--sec`.

**## Deploy Workflow**
Step-by-step:
1. Navigate to project root (where `.nsite/config.json` lives)
2. Run: `nsyte deploy <directory>` (e.g., `nsyte deploy ./dist`)
3. Common flags: `--force` (re-upload all), `--fallback=/index.html` (SPA routing), `--non-interactive` (CI mode)

**## Deploy Output Interpretation**
Three states from deploy.ts lines 1496-1507:
- Full success: `{N} files uploaded successfully ({size})` — all files to all servers
- Partial success: `{uploaded}/{total} files uploaded successfully` — check Blossom Server Summary
- Total failure: `"Failed to upload any files"` — check Relay Issues and Errors sections
- After any deploy: gateway URL printed: `https://{npub}.nsite.lol/`

**## Error Recovery**
Document from deploy.ts lines 1511-1585:
- Relay unavailable: check relay URLs in .nsite/config.json; try adding `--use-fallback-relays` flag
- Blossom rejection: check server list in .nsite/config.json; try another server
- Auth error: verify --sec value format; re-run `nsyte bunker add` if using stored bunker; check that nbunksec has not expired
- Config missing: run `nsyte init` first, or pass all config via CLI flags

**## Non-Interactive / CI Mode**
- Use `--non-interactive` flag
- Requires `.nsite/config.json` to exist beforehand
- Auth via `--sec "${NBUNK_SECRET}"` (env var passed as flag value)
- Exit codes: 0 = success, non-zero = failure

IMPORTANT: Keep body under 200 lines. Direct agents to `nsyte deploy --help` for full flag list. Move Nostr vocabulary to concepts reference, do not inline.
  </action>
  <verify>
    <automated>cd /home/sandwich/Develop/nsyte && skills-ref validate .agents/skills/nsyte-deploy 2>&1 || echo "skills-ref not available, checking manually" && head -1 .agents/skills/nsyte-deploy/SKILL.md && wc -l .agents/skills/nsyte-deploy/SKILL.md</automated>
    <manual>Verify SKILL.md body includes: auth decision tree, deploy command, output interpretation, error recovery, CI mode</manual>
  </verify>
  <done>nsyte-deploy/SKILL.md has a complete body covering authentication, deploy workflow, output interpretation, error recovery, and CI/CD mode. Body is under 200 lines. No references to non-existent commands or flags.</done>
</task>

<task type="auto">
  <name>Task 2: Fix nostr-concepts.md and add nsyte-concepts SKILL.md body</name>
  <files>.agents/skills/nsyte-concepts/references/nostr-concepts.md, .agents/skills/nsyte-concepts/SKILL.md</files>
  <action>
Two targeted edits:

**1. Fix nostr-concepts.md — replace `nsyte login` with `nsyte init`:**

In the Pubkey section, change:
- "the user must run `nsyte login` or `nsyte bunker add`" → "the user must run `nsyte init` or `nsyte bunker add`"

In the nsec / Private Key section, change:
- "advise the user to use `nsyte login` for interactive key input" → "advise the user to use `nsyte init` for interactive key setup"
- "direct them to `nsyte login` (interactive)" → "direct them to `nsyte init` (interactive)"

Do NOT change any other content in nostr-concepts.md. The file is otherwise correct.

**2. Add minimal body to nsyte-concepts/SKILL.md:**

Keep existing frontmatter unchanged (name, description, metadata.user-invocable: false). Replace the stub comment with a minimal body (10-20 lines) that:
- States this skill provides background Nostr/Blossom domain knowledge
- Points to `references/nostr-concepts.md` as the primary content
- Lists the concepts covered: relays, pubkeys, private keys, Blossom servers, NIP-46 bunker auth, Nostr events
- Notes this skill is auto-loaded as context, not invoked directly
  </action>
  <verify>
    <automated>cd /home/sandwich/Develop/nsyte && grep -c "nsyte login" .agents/skills/nsyte-concepts/references/nostr-concepts.md && echo "FAIL: nsyte login still present" || echo "PASS: no nsyte login references" && skills-ref validate .agents/skills/nsyte-concepts 2>&1 || echo "skills-ref not available" && wc -l .agents/skills/nsyte-concepts/SKILL.md</automated>
    <manual>Check that nostr-concepts.md references nsyte init (not nsyte login) and nsyte-concepts SKILL.md has a real body</manual>
  </verify>
  <done>nostr-concepts.md references `nsyte init` everywhere (zero occurrences of `nsyte login`). nsyte-concepts/SKILL.md has a minimal body pointing to the references file. Both pass skills-ref validate.</done>
</task>

</tasks>

<verification>
1. `skills-ref validate .agents/skills/nsyte-deploy` passes (or manual check)
2. `skills-ref validate .agents/skills/nsyte-concepts` passes (or manual check)
3. `wc -l .agents/skills/nsyte-deploy/SKILL.md` shows body content under 200 lines
4. `grep "nsyte login" .agents/skills/nsyte-concepts/references/nostr-concepts.md` returns no matches
5. nsyte-deploy SKILL.md references nsyte-concepts for domain vocabulary
6. nsyte-deploy SKILL.md does NOT reference --nbunksec flag or standalone env var auth
7. nsyte-deploy SKILL.md includes all three output states (full success, partial, failure)
</verification>

<success_criteria>
- nsyte-deploy/SKILL.md covers: auth decision tree, deploy workflow, output interpretation, error recovery, CI/CD mode
- nostr-concepts.md corrected: all `nsyte login` replaced with `nsyte init`
- nsyte-concepts/SKILL.md has minimal useful body (not just a stub)
- SKILL.md bodies under 200 lines each
- No references to non-existent commands (nsyte login) or flags (--nbunksec)
</success_criteria>

<output>
After completion, create `.planning/phases/02-install-and-deploy-skills/02-02-SUMMARY.md`
</output>
