---
phase: 02-install-and-deploy-skills
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .agents/skills/nsyte-setup/SKILL.md
  - scripts/check-deno.ts
  - scripts/check-network.ts
autonomous: true
requirements:
  - SETUP-01
  - SETUP-02
  - SETUP-03

must_haves:
  truths:
    - "nsyte-setup SKILL.md body contains installation detection via nsyte --version"
    - "nsyte-setup SKILL.md body contains platform-specific install commands for Linux, macOS, and Windows"
    - "nsyte-setup SKILL.md body contains nsyte init workflow with auth method selection"
    - "scripts/check-deno.ts exits 0 when Deno 2.x is available and exits 1 otherwise"
    - "scripts/check-network.ts exits 0 when relay and Blossom server are reachable and exits 1 otherwise"
  artifacts:
    - path: ".agents/skills/nsyte-setup/SKILL.md"
      provides: "Install detection, multi-platform install, nsyte init workflow"
      contains: "nsyte --version"
    - path: "scripts/check-deno.ts"
      provides: "Deno runtime pre-flight check"
      contains: "Deno.Command"
    - path: "scripts/check-network.ts"
      provides: "Network access pre-flight check"
      contains: "fetch"
  key_links:
    - from: ".agents/skills/nsyte-setup/SKILL.md"
      to: "scripts/check-deno.ts"
      via: "skill body references pre-flight script path"
      pattern: "scripts/check-deno"
    - from: ".agents/skills/nsyte-setup/SKILL.md"
      to: "scripts/check-network.ts"
      via: "skill body references pre-flight script path"
      pattern: "scripts/check-network"
---

<objective>
Write the nsyte-setup skill body and two pre-flight validation scripts so that an agent encountering nsyte for the first time can detect installation, install on any platform, run nsyte init, and validate prerequisites.

Purpose: The setup skill is the prerequisite chain root — every other nsyte skill assumes nsyte is installed. Pre-flight scripts give agents a programmatic way to verify Deno and network access before attempting installation or deployment.

Output: Complete nsyte-setup/SKILL.md body, scripts/check-deno.ts, scripts/check-network.ts
</objective>

<execution_context>
@/home/sandwich/.claude/get-shit-done/workflows/execute-plan.md
@/home/sandwich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-install-and-deploy-skills/02-RESEARCH.md
@.agents/skills/nsyte-setup/SKILL.md
@scripts/debug-linux-keystore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write nsyte-setup SKILL.md body</name>
  <files>.agents/skills/nsyte-setup/SKILL.md</files>
  <action>
Replace the stub comment in nsyte-setup/SKILL.md with a complete skill body. Keep the existing frontmatter (name, description) unchanged. The body must be procedural and decision-tree-driven, targeting 150-200 lines max.

Structure the body with these sections:

**## Prerequisites**
- Reference `scripts/check-deno.ts` for Deno runtime verification
- Note: Deno 2.x required for `deno install` path; not needed for binary install path

**## Detect Installation**
- Run `nsyte --version`
- If exits 0: installed, skip to "Initialize Project"
- If command not found: proceed to "Install nsyte"

**## Install nsyte**
Decision tree by platform:

Linux/macOS (recommended — pre-built binary, no Deno needed):
```
curl -fsSL https://nsyte.run/get/install.sh | bash
```

Linux/macOS alternative (requires Deno 2.x):
```
deno install -A -f -g -n nsyte jsr:@nsyte/cli
```

Windows:
- Download binary from https://github.com/sandwichfarm/nsyte/releases
- Install to $HOME/bin, add to PATH manually

**## Verify Installation**
- Run `nsyte --version` again
- If fails: PATH not updated; advise restart shell or add install dir to PATH
- Linux/macOS install dir: /usr/local/bin
- Windows install dir: $HOME/bin

**## Initialize Project**
Document `nsyte init` workflow:
1. Run `nsyte init` in project root
2. Interactive prompts for: auth method (new key / existing nsec or hex / NIP-46 bunker), relay configuration, Blossom server configuration
3. Writes `.nsite/config.json`
4. Success output: "Project initialized successfully with: ..."

**## Troubleshooting**
- PATH issues after install
- Permission denied on Linux (may need chmod +x or sudo for /usr/local/bin)
- Deno version too old (need 2.x for deno install path)

IMPORTANT: Do NOT reference `nsyte login` — this command does not exist. The correct command is `nsyte init`. Do NOT document env var auth modes — nsyte uses `--sec` flag only. Keep body under 200 lines to stay within SPEC-03 token budget (Phase 4 will enforce 500-line limit).
  </action>
  <verify>
    <automated>cd /home/sandwich/Develop/nsyte && skills-ref validate .agents/skills/nsyte-setup 2>&1 || echo "skills-ref not available, checking manually" && head -1 .agents/skills/nsyte-setup/SKILL.md && wc -l .agents/skills/nsyte-setup/SKILL.md</automated>
    <manual>Verify SKILL.md body includes: detection step, platform install commands, nsyte init workflow, troubleshooting</manual>
  </verify>
  <done>nsyte-setup/SKILL.md has a complete body covering install detection, multi-platform install, nsyte init, and troubleshooting. Body is under 200 lines. skills-ref validate passes or manual check confirms valid frontmatter + body content.</done>
</task>

<task type="auto">
  <name>Task 2: Write pre-flight validation scripts</name>
  <files>scripts/check-deno.ts, scripts/check-network.ts</files>
  <action>
Create two Deno TypeScript pre-flight scripts following the pattern from `scripts/debug-linux-keystore.ts`.

**scripts/check-deno.ts:**
- Shebang: `#!/usr/bin/env -S deno run --allow-run`
- Check Deno runtime: run `deno --version` via `Deno.Command`
- Parse version from output, verify major version >= 2
- Exit 0 with success message if Deno 2.x found
- Exit 1 with clear error if Deno not found or version too old
- Print: `✓ Deno {version} (meets nsyte requirement: 2.x)` on success
- Print: `✗ Deno not found. Install from: https://deno.land/` on not found
- Print: `✗ Deno {version} found but nsyte requires Deno 2.x` on version mismatch

**scripts/check-network.ts:**
- Shebang: `#!/usr/bin/env -S deno run --allow-net`
- Check two endpoints with fetch + AbortSignal.timeout(5000):
  1. Relay: attempt WebSocket-compatible HTTP request to `wss://relay.damus.io` (use `https://relay.damus.io` for fetch, check for response)
  2. Blossom: fetch `https://blossom.primal.net` (check for HTTP response)
- Report per-endpoint pass/fail
- Exit 0 only if both checks pass; exit 1 if either fails
- Print: `✓ Relay connectivity: relay.damus.io reachable` / `✗ Relay connectivity: relay.damus.io unreachable`
- Print: `✓ Blossom connectivity: blossom.primal.net reachable` / `✗ Blossom connectivity: blossom.primal.net unreachable`

IMPORTANT: Scripts ONLY report — they never install, modify, or elevate privileges. No sudo, no deno install, no PATH modifications. Use `Deno.exit(1)` for failures, not `throw`. Follow project code style from AGENTS.md (camelCase functions, clear error messages).
  </action>
  <verify>
    <automated>cd /home/sandwich/Develop/nsyte && deno check scripts/check-deno.ts && deno check scripts/check-network.ts && echo "Type check passed"</automated>
    <manual>Run `deno run --allow-run scripts/check-deno.ts` and verify it reports Deno version. Run `deno run --allow-net scripts/check-network.ts` and verify it reports connectivity status.</manual>
  </verify>
  <done>Both scripts exist, pass deno check, and when executed: check-deno.ts reports Deno version status with exit 0/1, check-network.ts reports relay and Blossom connectivity with exit 0/1.</done>
</task>

</tasks>

<verification>
1. `skills-ref validate .agents/skills/nsyte-setup` passes (or manual frontmatter check)
2. `wc -l .agents/skills/nsyte-setup/SKILL.md` shows body content (not just stub)
3. `deno check scripts/check-deno.ts` passes
4. `deno check scripts/check-network.ts` passes
5. nsyte-setup SKILL.md references both pre-flight scripts by path
6. nsyte-setup SKILL.md does NOT reference `nsyte login` (uses `nsyte init` instead)
</verification>

<success_criteria>
- nsyte-setup/SKILL.md covers: detection (nsyte --version), platform install (Linux/macOS/Windows), nsyte init workflow, troubleshooting
- Two pre-flight scripts exist and type-check clean
- SKILL.md body under 200 lines
- No references to non-existent commands (nsyte login) or non-existent flags (--nbunksec)
</success_criteria>

<output>
After completion, create `.planning/phases/02-install-and-deploy-skills/02-01-SUMMARY.md`
</output>
