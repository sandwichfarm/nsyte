---
phase: 01-scaffolding
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - .agents/skills/nsyte-concepts/references/nostr-concepts.md
autonomous: true
requirements:
  - SPEC-01
  - SPEC-02
  - SPEC-05

must_haves:
  truths:
    - "nostr-concepts.md exists at .agents/skills/nsyte-concepts/references/nostr-concepts.md with definitions for relay, pubkey, nsec/private key, Blossom server, NIP-46/bunker, and Nostr event"
    - "Every definition is written as agent instructions (what the agent should do/know), not encyclopedia entries"
    - "skills-ref validate passes for all six skill directories with no errors"
    - "All example values are placeholders — no real relay URLs, real pubkeys, or real private keys"
  artifacts:
    - path: ".agents/skills/nsyte-concepts/references/nostr-concepts.md"
      provides: "Shared Nostr/Blossom domain vocabulary for all skills"
      min_lines: 60
      contains: "## Relay"
  key_links:
    - from: ".agents/skills/nsyte-concepts/references/nostr-concepts.md"
      to: "later phase skills"
      via: "referenced from within nsyte-concepts/ skill directory"
      pattern: "## (Relay|Pubkey|Blossom|NIP-46|Event|nsec)"
---

<objective>
Write the full content of `nostr-concepts.md` (the shared Nostr/Blossom vocabulary reference file) and validate all six skill directories pass `skills-ref validate` with no errors.

Purpose: Establish a single canonical definition source for Nostr/Blossom vocabulary so later-phase skills share consistent terminology. Validate-clean skills before any body content is written, so Phase 2 starts from a known-good state.
Output: A complete `nostr-concepts.md` reference file and a clean `skills-ref validate` result for all six skills.
</objective>

<execution_context>
@/home/sandwich/.claude/get-shit-done/workflows/execute-plan.md
@/home/sandwich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-scaffolding/1-RESEARCH.md
@.planning/phases/01-scaffolding/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write nostr-concepts.md with full agent-readable definitions</name>
  <files>
    .agents/skills/nsyte-concepts/references/nostr-concepts.md
  </files>
  <action>
Write `.agents/skills/nsyte-concepts/references/nostr-concepts.md` using the Write tool. This file must define every Nostr/Blossom concept an agent needs when executing nsyte commands, written for agents with ZERO prior Nostr knowledge.

**Writing rules:**
- Every definition must include an "**For agents:**" paragraph explaining what the agent should DO with this concept, not just what it is
- All example values must be placeholders (e.g., `wss://relay.example.com`, not `wss://relay.damus.io` in the canonical definitions — use public relay examples only in "For agents" fallback suggestions)
- No real pubkeys, no real private keys, no real relay URLs that belong to specific users
- Write in CommonMark Markdown
- Target: 60-120 lines — comprehensive but not bloated

**Required sections (in this order):**

1. **## Relay** — WebSocket server at a WSS URL; nsyte publishes site metadata events to relays; agent guidance for when user hasn't configured relays (suggest `wss://relay.damus.io` and `wss://nos.lol` as well-known public relays); config stored in `.nsite/config.json`

2. **## Pubkey** — 64-character lowercase hex string identifying a Nostr user; also appears as npub bech32 (`npub1...`); nsyte uses pubkey to identify site ownership; example format only (placeholder hex string)

3. **## nsec / Private Key** — 64-character hex or nsec bech32 format; used to sign Nostr events; MUST NEVER be logged, committed to source control, or passed as a CLI argument in visible shell history; nsyte stores keys securely via OS keychain or encrypted fallback at `.nsite/.secrets.enc`

4. **## Blossom Server** — HTTP/HTTPS file storage server; nsyte uploads static site files as blobs indexed by SHA-256 hash; agent guidance for when user hasn't configured Blossom servers (suggest `https://blossom.primal.net` as a well-known public server); config stored in `.nsite/config.json`

5. **## NIP-46 / Bunker Auth** — Remote signing protocol; agent connects to a remote signer via `bunker://` URI without the private key being present locally; nsyte sets up bunker via `nsyte bunker add <connection-string>`; preferred for CI/CD and non-interactive deployments; avoids storing private key in env vars or files

6. **## Nostr Event** — Signed JSON object; all Nostr data (messages, site metadata, file references) is an event; nsyte publishes events of specific kinds to announce sites; agents do not need to construct events manually — nsyte handles this

**File header:**
```markdown
# Nostr Concepts Reference

Agent-readable definitions of Nostr protocol, Blossom storage, and authentication concepts used by nsyte commands. Written for agents with no prior Nostr knowledge.

---
```

**Anti-patterns to avoid:**
- Writing encyclopedia entries ("Events are immutable data structures signed with secp256k1 keys") — agents cannot act on jargon
- Missing "For agents:" guidance — every definition MUST include actionable agent instructions
- Mentioning real user pubkeys or private keys in examples — use placeholder strings only
  </action>
  <verify>
    <automated>
      wc -l .agents/skills/nsyte-concepts/references/nostr-concepts.md &amp;&amp; grep -c "^## " .agents/skills/nsyte-concepts/references/nostr-concepts.md
    </automated>
    <manual>Read the file. Confirm: (1) six sections present (Relay, Pubkey, nsec/Private Key, Blossom Server, NIP-46/Bunker Auth, Nostr Event), (2) every section has a "For agents:" paragraph, (3) no real credentials appear anywhere.</manual>
  </verify>
  <done>nostr-concepts.md is 60+ lines, has six ## sections, every section has agent-actionable guidance, and no real credentials are present.</done>
</task>

<task type="auto">
  <name>Task 2: Install skills-ref validator and validate all six skills</name>
  <files></files>
  <action>
Install the `skills-ref` Python validator in a venv (dev-time only, not committed) and run it against all six skill directories. Fix any errors before declaring this task complete.

**Step 1: Check if skills-ref is already installed**
```bash
which skills-ref 2>/dev/null || echo "not found"
```

**Step 2: If not installed, install from source**

The agentskills.io skills-ref validator is available at `https://github.com/agentskills/agentskills`. Clone it or install via pip from the source. Try these approaches in order:

```bash
# Option A: pip install from GitHub directly (no clone needed)
python3 -m venv /tmp/skills-ref-venv
source /tmp/skills-ref-venv/bin/activate
pip install git+https://github.com/agentskills/agentskills.git#subdirectory=skills-ref

# Option B: If Option A fails, clone and install
git clone --depth=1 https://github.com/agentskills/agentskills.git /tmp/agentskills-src
cd /tmp/agentskills-src/skills-ref
pip install -e .
```

**Step 3: Run validation against all six skill directories**
```bash
source /tmp/skills-ref-venv/bin/activate
skills-ref validate .agents/skills/nsyte-setup
skills-ref validate .agents/skills/nsyte-deploy
skills-ref validate .agents/skills/nsyte-config
skills-ref validate .agents/skills/nsyte-auth
skills-ref validate .agents/skills/nsyte-ci
skills-ref validate .agents/skills/nsyte-concepts
```

**Step 4: If skills-ref is unavailable (network/install failure), run manual validation**

If `skills-ref` cannot be installed, perform manual structural validation:
```bash
# Verify name fields match directory names exactly
for d in .agents/skills/*/; do
  skill=$(basename "$d")
  name=$(grep "^name:" "$d/SKILL.md" 2>/dev/null | head -1 | sed 's/name: //')
  if [ "$skill" = "$name" ]; then
    echo "OK: $skill"
  else
    echo "MISMATCH: dir=$skill name=$name"
  fi
done

# Verify description fields are present
for d in .agents/skills/*/; do
  skill=$(basename "$d")
  desc=$(grep "^description:" "$d/SKILL.md" 2>/dev/null | wc -l)
  if [ "$desc" -ge 1 ]; then
    echo "OK description: $skill"
  else
    echo "MISSING description: $skill"
  fi
done
```

**Step 5: Fix any errors found**

Common errors and fixes:
- Name mismatch: Update the `name:` field to exactly match the directory name
- Missing description: Add a third-person description field
- Invalid name format (uppercase, underscore): Rename directory or fix name field

After fixing, re-run validation until all six pass.

**Important:** The venv at `/tmp/skills-ref-venv` is a dev tool only. Do NOT add it to the repository. Do NOT add `pip install` to any project scripts.
  </action>
  <verify>
    <automated>
      for d in .agents/skills/*/; do skill=$(basename "$d"); name=$(grep "^name:" "$d/SKILL.md" 2>/dev/null | head -1 | sed 's/name: //'); if [ "$skill" = "$name" ]; then echo "OK: $skill"; else echo "MISMATCH: dir=$skill name=$name"; fi; done
    </automated>
    <manual>All six skills should print OK. If skills-ref was available, confirm it reported no errors for any skill.</manual>
  </verify>
  <done>All six skills pass structural validation: name fields match directory names, description fields present. If skills-ref was installable, all six pass skills-ref validate with zero errors.</done>
</task>

</tasks>

<verification>
Final phase check after both tasks complete:

```bash
# 1. Confirm directory structure
find .agents/skills -type f | sort

# 2. Confirm name/directory alignment for all six skills
for d in .agents/skills/*/; do
  skill=$(basename "$d")
  name=$(grep "^name:" "$d/SKILL.md" 2>/dev/null | head -1 | sed 's/name: //')
  echo "$skill -> $name"
done

# 3. Confirm nostr-concepts.md exists and has content
wc -l .agents/skills/nsyte-concepts/references/nostr-concepts.md

# 4. Confirm special frontmatter fields
grep "disable-model-invocation" .agents/skills/nsyte-deploy/SKILL.md
grep "user-invocable" .agents/skills/nsyte-concepts/SKILL.md
```

Expected output:
- Six SKILL.md files, one in each skill directory
- nostr-concepts.md present with 60+ lines
- nsyte-deploy shows disable-model-invocation: true
- nsyte-concepts shows user-invocable: false
- All name -> directory values match exactly
</verification>

<success_criteria>
- `.agents/skills/nsyte-concepts/references/nostr-concepts.md` exists with 60+ lines
- Six sections present: Relay, Pubkey, nsec/Private Key, Blossom Server, NIP-46/Bunker Auth, Nostr Event
- Every section has agent-actionable "For agents:" guidance
- No real credentials, real pubkeys, or real relay URLs that belong to specific users appear in examples
- `skills-ref validate` passes for all six skills (or manual structural validation shows zero mismatches if skills-ref unavailable)
- Phase 1 roadmap success criteria 1-4 are all satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/01-scaffolding/01-02-SUMMARY.md` using the summary template at `@/home/sandwich/.claude/get-shit-done/templates/summary.md`.
</output>
